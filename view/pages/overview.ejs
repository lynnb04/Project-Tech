<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="/overview.css">
</head>
<body>
    <%- include('../partials/header'); %>
    <main>

            <!-- Zoekbalk -->
    <form method="GET" action="/concerten" role="search" class="search-bar">
        <input 
          type="search" 
          name="q" 
          placeholder="Zoek concerten..." 
          value="<%= typeof query !== 'undefined' ? query : '' %>"
        />
      </form>
  
            <!-- Filter en Sorteer knoppen -->
      <nav class="controls">
        <button class="filter" type="button">Filter</button>
        <span class="filter-count">0</span>
        <button class="sort" type="button">Sorteren</button>
      </nav>

      <!-- Uitklapbaar filtermenu -->
      <div class="filter-menu hidden">
        <details>
          <summary>Locatie</summary>
          <div class="filter-options" data-filter-group="locatie">
            <% const provincies = ["Noord-Holland", "Zuid-Holland", "Utrecht", "Groningen", "Limburg", "Friesland", "Drenthe", "Overijssel", "Flevoland", "Gelderland", "Zeeland", "Noord-Brabant"]; %>
            <% provincies.forEach(function(provincie) { %>
              <div class="filter-tag" data-value="<%= provincie %>"><%= provincie %></div>
            <% }); %>
          </div>
        </details>

        <details>
          <summary>Datum</summary>
          <div>
            <label>Vanaf: <input type="date" class="date-filter" id="date-from"></label><br>
            <label>Tot aan: <input type="date" class="date-filter" id="date-to"></label>
          </div>
        </details>

        <details>
          <summary>Genre</summary>
          <div class="filter-options" data-filter-group="genre">
            <% const genres = ["genre1", "genre2", "genre3", "genre4", "genre5"]; %>
            <% genres.forEach(function(genre) { %>
              <div class="filter-tag" data-value="<%= genre %>"><%= genre %></div>
            <% }); %>
          </div>
        </details>
      </div>

    <!-- Concert cards -->
    <section>
         <article>
            <ul>
                <% events.forEach(function(event) { %>
                    <li>
                        <img src="<%= event.images[1].url %>" alt="Foto van Event">
                        <h1><%= event.name %></h1>
                        
                        <p><%= event.dates.start.localDate %></p>
                        <p><%= event._embedded.venues[0].city.name %></p>
                        
                        <!-- niet elk concert heeft een genre of subgenre dus hier code om dit op te lossen -->
                        <div>
                            <% if (
                                event.classifications &&
                                event.classifications.length > 0 &&
                                event.classifications[0].genre &&
                                event.classifications[0].genre.name
                                ) { %>
                                <p><%= event.classifications[0].genre.name %></p>
                                <% } else { %>
                                <p>Niet beschikbaar</p>
                            <% } %>

                            <% if (
                                event.classifications &&
                                event.classifications.length > 0 &&
                                event.classifications[0].subGenre &&
                                event.classifications[0].subGenre.name
                                ) { %>
                                <p><%= event.classifications[0].subGenre.name %></p>
                                <% } else { %>
                                <p>Niet beschikbaar</p>
                            <% } %>
                        </div>
                        

                    </li>
                <% }); %>
            </ul>
        </article>
    </section>
    </main>
    <%- include('../partials/footer'); %>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const filterBtn = document.querySelector(".filter");
        const filterMenu = document.querySelector(".filter-menu");
        const filterCountDisplay = document.querySelector(".filter-count");
      
        if (!filterBtn || !filterMenu) {
          console.warn("Filter-knop of menu niet gevonden");
          return;
        }
      
        filterBtn.addEventListener("click", () => {
          filterMenu.classList.toggle("hidden");
          updateFilterCount();
        });
      
        document.querySelectorAll(".filter-tag").forEach(tag => {
          tag.addEventListener("click", () => {
            tag.classList.toggle("selected");
            updateFilterCount();
          });
        });
      
        document.querySelectorAll(".date-filter").forEach(input => {
          input.addEventListener("change", updateFilterCount);
        });
      
        function updateFilterCount() {
          const selectedTags = document.querySelectorAll(".filter-tag.selected").length;
          const selectedDates = Array.from(document.querySelectorAll(".date-filter")).filter(i => i.value !== "").length;
          const total = selectedTags + selectedDates;
          filterCountDisplay.textContent = total;
        }
      });
      </script>
</body>
</html>